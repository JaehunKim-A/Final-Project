<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTable - Mazer Admin Dashboard</title>

    <link rel="shortcut icon" href="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/1999/svg'%20viewBox='0%200%2033%2034'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20xmlns:v='https://vecta.io/nano'%3e%3cpath%20d='M3%2027.472c0%204.409%206.18%205.552%2013.5%205.552%207.281%200%2013.5-1.103%2013.5-5.513s-6.179-5.552-13.5-5.552c-7.281%200-13.5%201.103-13.5%205.513z'%20fill='%23435ebe'%20fill-rule='nonzero'/%3e%3ccircle%20cx='16.5'%20cy='8.8'%20r='8.8'%20fill='%2341bbdd'/%3e%3c/svg%3e" type="image/x-icon">
    <link rel="stylesheet" href="/assets/extensions/simple-datatables/style.css">
    <link rel="stylesheet" href="/assets/compiled/css/table-datatable.css">
    <link rel="stylesheet" href="/assets/compiled/css/app.css">
    <link rel="stylesheet" href="/assets/compiled/css/app-dark.css">
</head>

<body>
<script src="/assets/static/js/initTheme.js"></script>
<div id="app">
    <div th:replace="~{dist/index :: sidebar}"></div></div>
<div id="main">
    <header class="mb-3">
        <a href="#" class="burger-btn d-block d-xl-none">
            <i class="bi bi-justify fs-3"></i>
        </a>
    </header>

    <div class="page-heading">
        <div class="page-title">
            <div class="row">
                <div class="col-12 col-md-6 order-md-1 order-last">
                    <h3>DataTable</h3>
                    <p class="text-subtitle text-muted">A sortable, searchable, paginated table without dependencies thanks to simple-datatables.</p>
                </div>
                <div class="col-12 col-md-6 order-md-2 order-first">
                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                            <li class="breadcrumb-item active" aria-current="page">DataTable</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
        <section class="section">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Simple Datatable</h4>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#registerModal">Add New Customer</button>
                </div>
                <div class="card-body">
                    <table class="table table-striped" id="table1">
                        <thead>
                        <tr>
                            <th th:each="col : ${columns}" th:text="${col}"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="customer : ${customers}">
                            <td th:text="${customer.customerId}"></td>
                            <td th:text="${customer.customerName}"></td>
                            <td th:text="${customer.contactInfo}"></td>
                            <td th:text="${customer.address}"></td>
                            <td th:text="${customer.formattedRegDate}"></td>
                            <td th:text="${customer.formattedModDate}"></td>
                            <td>
                                <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editModal"
                                        th:data-id="${customer.customerId}"
                                        th:data-name="${customer.customerName}"
                                        th:data-contact="${customer.contactInfo}"
                                        th:data-address="${customer.address}"
                                        th:data-reg="${customer.regDate}"
                                        th:data-mod="${customer.modDate}">Edit</button>
                                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal" th:data-id="${customer.customerId}">Delete</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- 고객 등록 모달 -->
        <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="registerModalLabel">Register New Customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="/table/customer/register" method="POST">
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="customerName" class="form-label">Customer Name</label>
                                <input type="text" class="form-control" id="customerName" name="customerName" required>
                            </div>
                            <div class="mb-3">
                                <label for="contactInfo" class="form-label">Contact Information</label>
                                <input type="text" class="form-control" id="contactInfo" name="contactInfo" required>
                            </div>
                            <div class="mb-3">
                                <label for="address" class="form-label">Address</label>
                                <input type="text" class="form-control" id="address" name="address" required>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Register</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 고객 수정 모달 -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Edit Customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="/table/customer/edit/{customerId}" method="POST" id="editCustomerForm">
                        <div class="modal-body">
                            <input type="hidden" id="editCustomerId" name="customerId">
                            <div class="mb-3">
                                <label for="editCustomerName" class="form-label">Customer Name</label>
                                <input type="text" class="form-control" id="editCustomerName" name="customerName" required>
                            </div>
                            <div class="mb-3">
                                <label for="editContactInfo" class="form-label">Contact Information</label>
                                <input type="text" class="form-control" id="editContactInfo" name="contactInfo" required>
                            </div>
                            <div class="mb-3">
                                <label for="editAddress" class="form-label">Address</label>
                                <input type="text" class="form-control" id="editAddress" name="address" required>
                            </div>
                            <div class="mb-3">
                                <label for="editRegDate" class="form-label">Registration Date</label>
                                <input type="text" class="form-control" id="editRegDate" name="regDate" readonly>
                            </div>
                            <div class="mb-3">
                                <label for="editModDate" class="form-label">Modification Date</label>
                                <input type="text" class="form-control" id="editModDate" name="modDate" readonly>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 고객 삭제 모달 -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Delete Customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this customer?</p>
                    </div>
                    <div class="modal-footer">
                        <form action="#" method="GET" id="deleteCustomerForm">
                            <input type="hidden" id="deleteCustomerId" name="customerId">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer>
        <div class="footer clearfix mb-0 text-muted">
            <div class="float-start">
                <p>2023 &copy; Mazer</p>
            </div>
            <div class="float-end">
                <p>Crafted with <span class="text-danger"><i class="bi bi-heart-fill icon-mid"></i></span>
                    by <a href="https://saugi.me">Saugi</a></p>
            </div>
        </div>
    </footer>
</div>
</div>

<script src="/assets/static/js/initTheme.js"></script>
<script src="/assets/static/js/components/dark.js"></script>
<script src="/assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js"></script>
<script src="/assets/compiled/js/app.js"></script>
<script src="/assets/extensions/simple-datatables/umd/simple-datatables.js"></script>
<script src="/assets/static/js/pages/simple-datatables.js"></script>


<script>
    document.addEventListener("DOMContentLoaded", function() {

    const tableBody = document.querySelector("#table1");
    const myDataTable = new simpleDatatables.DataTable(tableBody, {
        perPage: 10,
        searchable: true,
        sortable: true,
        labels: {
            placeholder: "고객을 검색하세요...",
            perPage: "{select} 행을 한 페이지에 표시",
            noRows: "고객을 찾을 수 없습니다.",
            info: "전체 {rows}개의 고객 중 {start}에서 {end}까지 표시",
        },
    });

    // 수정 버튼 클릭 (이벤트 위임)
    document.querySelector("#table1").addEventListener("click", (e) => {
        const btn = e.target.closest(".btn-warning");
        if (btn) {
            const customerId = btn.getAttribute("data-id");
            const customerName = btn.getAttribute("data-name");
            const contactInfo = btn.getAttribute("data-contact");
            const address = btn.getAttribute("data-address");
            const regDate = btn.getAttribute("data-reg");
            const modDate = btn.getAttribute("data-mod");

            document.getElementById("editCustomerId").value = customerId;
            document.getElementById("editCustomerName").value = customerName;
            document.getElementById("editContactInfo").value = contactInfo;
            document.getElementById("editAddress").value = address;
            document.getElementById("editRegDate").value = regDate;
            document.getElementById("editModDate").value = modDate;
        }
    });

    const editCustomerForm = document.getElementById("editCustomerForm");
    editCustomerForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const formData = new FormData(editCustomerForm);
        const customerId = document.getElementById("editCustomerId").value;
        fetch(`/table/customer/edit/${customerId}`, {
            method: "POST",
            body: formData,
        })
        .then((response) => {
            if (response.ok) {
                alert("고객 정보가 수정되었습니다.");
                location.reload();
            } else {
                alert("고객 수정에 실패했습니다.");
            }
        })
        .catch((error) => {
            alert("에러 발생: 고객 수정 실패");
            console.error("에러:", error);
        });
    });

    // 삭제 버튼 클릭 → customerId 세팅
    document.querySelector("#table1").addEventListener("click", (e) => {
        const btn = e.target.closest(".btn-danger");
        if (btn) {
            const customerId = btn.getAttribute("data-id");
            console.log("선택된 고객 ID:", customerId); // 디버깅용
            document.getElementById("deleteCustomerId").value = customerId;
        }
    });

    // 삭제 폼 제출 → GET 요청으로 리다이렉트
    const deleteCustomerForm = document.getElementById("deleteCustomerForm");
    deleteCustomerForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const customerId = document.getElementById("deleteCustomerId").value;

        if (!customerId) {
            alert("고객 ID가 없습니다.");
            return;
        }

        location.href = `/table/customer/delete/${customerId}`;
        });
    });
</script>




</body>
</html>
